name: Add Gradle Wrapper

on:
  workflow_dispatch:

jobs:
  add-wrapper:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Set up JDK 17
      uses: actions/setup-java@v4
      with:
        distribution: 'temurin'
        java-version: '17'
    
    - name: Download and setup Gradle
      run: |
        cd /tmp
        wget https://services.gradle.org/distributions/gradle-8.11.1-bin.zip
        unzip -q gradle-8.11.1-bin.zip
        export PATH=/tmp/gradle-8.11.1/bin:$PATH
        gradle --version
    
    - name: Generate Gradle Wrapper files
      run: |
        export PATH=/tmp/gradle-8.11.1/bin:$PATH
        cd $GITHUB_WORKSPACE
        gradle wrapper --gradle-version 8.11.1 --distribution-type bin
    
    - name: Make gradlew executable
      run: chmod +x gradlew
    
    - name: Commit and push wrapper files
      run: |
        git config user.name "github-actions[bot]"
        git config user.email "github-actions[bot]@users.noreply.github.com"
        git add gradle/wrapper/gradle-wrapper.jar
        git add gradlew
        git add gradlew.bat
        git commit -m "build: add Gradle wrapper files (gradlew, gradlew.bat, gradle-wrapper.jar)"
        git push
